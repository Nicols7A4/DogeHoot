<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Panel de Anfitrión - {{ pin }}</title>
    <style>
        /* Estilos simples para la demo */
        body {
            font-family: sans-serif;
            text-align: center;
        }

        .grupos-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 2rem;
        }

        .grupo-card {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 1rem;
            min-width: 200px;
        }
    </style>
</head>

<body>
    <h1>PIN: {{ pin }}</h1>
    <div id="estado-juego">Esperando jugadores...</div>
    <ul id="lista-jugadores"></ul>
    <button id="btn-comenzar" onclick="comenzarJuego()">Comenzar Juego</button>
    <div id="ranking"></div>
    <div id="extra"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        const socket = io();
        const pin = "{{ pin }}";

        function comenzarJuego() {
            socket.emit('iniciar_juego', { pin: pin });
            document.getElementById('btn-comenzar').style.display = 'none'; // Oculta el botón
        }

        socket.on('connect', () => socket.emit('iniciar_panel_anfitrion', { pin: pin }));

        socket.on('actualizar_estado_lobby', (data) => {
            const lista = document.getElementById('lista-jugadores');
            lista.innerHTML = '';
            let jugadores = data.participantes_sin_grupo;
            data.grupos.forEach(g => jugadores = jugadores.concat(g.miembros));
            jugadores.forEach(j => lista.innerHTML += `<li>${j}</li>`);
        });

        socket.on('nueva_pregunta', (data) => {
            document.getElementById('estado-juego').textContent = `Pregunta ${data.index + 1}: ${data.texto}`;
            document.getElementById('ranking').innerHTML = ''; // Limpia ranking anterior
        });

        socket.on('mostrar_resultados', (data) => {
            document.getElementById('estado-juego').textContent = `Mostrando resultados...`;
            const rankingDiv = document.getElementById('ranking');
            rankingDiv.innerHTML = '<h4>Ranking Actual:</h4><ol>';
            data.ranking.forEach(item => {
                rankingDiv.innerHTML += `<li>${item.nombre}: ${item.puntaje} puntos</li>`;
            });
            rankingDiv.innerHTML += '</ol>';
        });

        socket.on('juego_finalizado', (data) => {
            document.getElementById('estado-juego').textContent = `¡Juego Finalizado!`;
            const rankingDiv = document.getElementById('ranking');
            const extraDiv = document.getElementById('extra');
            rankingDiv.innerHTML = '<h2>Ranking Final:</h2><ol>';
            data.ranking.forEach(item => {
                rankingDiv.innerHTML += `<li>${item.nombre}: ${item.puntaje} puntos</li>`;
            });
            rankingDiv.innerHTML += '</ol>';
            // Aquí podrías añadir un botón para descargar el reporte
            extraDiv.innerHTML = `<a href="{{ url_for('cuestionarios') }}">Volver al mis cuestionarios</a>`;

        });
    </script>
</body>

</html>